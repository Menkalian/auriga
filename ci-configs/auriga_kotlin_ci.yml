kotlinPluginBuild:
  stage: libs-build
  image: gradle:6.7
  script:
    - cd auriga-kotlin-plugin
    - gradle --scan publishToMavenLocal
  artifacts:
    paths:
      - auriga-kotlin-plugin/build
    expire_in: 1 week

kotlinPluginTest:
  stage: libs-test
  image: gradle:6.7
  dependencies:
    - kotlinPluginBuild
  script:
    - cd auriga-kotlin-plugin
    - gradle test

kotlinPluginPublish:
  stage: libs-deploy
  image: gradle:6.7
  dependencies:
    - kotlinPluginTest
  only:
    - main
  script:
    - cd auriga-kotlin-plugin
    - gradle --scan publish
  artifacts:
    paths:
      - auriga-kotlin-plugin/build/libs/*.jar
    expire_in: 1 week